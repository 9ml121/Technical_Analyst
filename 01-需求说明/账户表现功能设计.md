# 账户表现功能设计

## 📋 功能概述

**模块名称**: 账户表现分析系统  
**核心目标**: 提供多维度的账户收益统计和分析，参考东方财富APP的表现分析功能  
**主要用户**: 量化投资者、策略分析师、投资顾问  

## 🎯 核心功能模块

### 1. 📊 多时间维度统计

#### 时间周期选择
- **日度统计** - 每日收益率和资产变化
- **周度统计** - 每周收益汇总和分析
- **月度统计** - 每月投资表现总结
- **年度统计** - 年度投资业绩回顾

#### 界面布局
```
┌─────────────────────────────────────────────────────────┐
│ 📈 账户表现分析                                         │
│ 总资产: ¥105,234  累计收益: +¥5,234  收益率: +5.23%    │
│                                    [日][周][月][年]     │
├─────────────────────────────────────────────────────────┤
│ 收益率曲线 [收益率][资产净值][回撤]                     │
│ ┌─────────────────────────────────────────────────────┐ │
│ │          📊 收益率曲线图                            │ │
│ └─────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

### 2. 📈 收益曲线分析

#### 多维度图表展示
- **收益率曲线**
  - 累计收益率变化
  - 日收益率分布
  - 收益率波动分析
  - 与基准对比曲线

- **资产净值曲线**
  - 资产价值变化轨迹
  - 资产增长趋势
  - 资产配置变化
  - 现金流入流出

- **回撤曲线**
  - 最大回撤分析
  - 回撤恢复时间
  - 回撤频率统计
  - 风险控制效果

#### 图表交互功能
- **时间范围选择** - 自定义查看时间段
- **指标切换** - 快速切换不同指标
- **数据标注** - 重要事件标记
- **缩放平移** - 图表交互操作

### 3. 📊 关键指标统计

#### 核心性能指标
- **最大收益** - 单日/周/月最高收益率
- **最大回撤** - 历史最大回撤幅度
- **胜率统计** - 盈利交易占比
- **夏普比率** - 风险调整后收益
- **波动率** - 收益率标准差
- **交易次数** - 各时间段交易频率

#### 指标卡片展示
```
┌─────────────────────────────────────────────────────────┐
│ 📈 最大收益    📉 最大回撤    🎯 胜率      ⚡ 夏普比率  │
│ +8.45%        -2.15%        65.2%       1.85         │
│ 2024-01-15    2024-01-12    23胜/12负   风险调整收益  │
│                                                         │
│ 📊 波动率      🔄 交易次数                              │
│ 12.5%         156                                      │
│ 年化波动率     本周期内                                 │
└─────────────────────────────────────────────────────────┘
```

### 4. 📋 收益明细表格

#### 详细数据展示
- **时间周期** - 根据选择的时间维度显示
- **期初资产** - 周期开始时的资产价值
- **期末资产** - 周期结束时的资产价值
- **收益金额** - 绝对收益数值
- **收益率** - 相对收益百分比
- **累计收益率** - 从开始到当前的总收益率
- **最大回撤** - 该周期内的最大回撤
- **交易次数** - 该周期内的交易频率

#### 表格功能
- **数据排序** - 按各列进行排序
- **数据筛选** - 筛选特定条件的数据
- **数据导出** - 导出Excel或CSV格式
- **数据刷新** - 实时更新最新数据

#### 表格示例
```
┌─────────────────────────────────────────────────────────┐
│ 📋 收益明细 (周)                      [导出][刷新]      │
├─────────────────────────────────────────────────────────┤
│时间      |期初资产 |期末资产 |收益金额|收益率|累计收益率│
├─────────────────────────────────────────────────────────┤
│2024第3周 |¥102,150|¥105,234|+¥3,084|+3.02%|+5.23%   │
│2024第2周 |¥100,890|¥102,150|+¥1,260|+1.25%|+2.15%   │
│2024第1周 |¥100,000|¥100,890|+¥890  |+0.89%|+0.89%   │
│2023第52周|¥101,200|¥100,000|-¥1,200|-1.19%|0.00%    │
└─────────────────────────────────────────────────────────┘
```

### 5. 📊 基准对比分析

#### 基准选择
- **上证指数** - 大盘整体表现基准
- **沪深300** - 大盘蓝筹股基准
- **深证成指** - 深市综合基准
- **创业板指** - 成长股基准

#### 对比指标
- **累计收益率对比** - 策略vs基准收益率
- **最大回撤对比** - 风险控制能力对比
- **夏普比率对比** - 风险调整收益对比
- **波动率对比** - 收益稳定性对比

#### 对比展示
```
┌─────────────────────────────────────────────────────────┐
│ 📊 基准对比分析                        [上证指数 ▼]     │
├─────────────────────────────────────────────────────────┤
│ 累计收益率: +5.23% vs +2.15%  → 超额 +3.08%           │
│ 最大回撤:   -2.15% vs -5.80%  → 控制更好 +3.65%       │
│ 夏普比率:   1.85   vs 0.92    → 表现更优 +0.93        │
└─────────────────────────────────────────────────────────┘
```

## 🏗️ 技术实现方案

### 数据模型设计

#### 账户表现数据表
```sql
CREATE TABLE account_performance (
    id SERIAL PRIMARY KEY,
    account_id INTEGER NOT NULL,
    date DATE NOT NULL,
    time_frame VARCHAR(10) NOT NULL, -- day/week/month/year
    period_label VARCHAR(50) NOT NULL, -- 2024-01-16, 2024年第3周等
    start_asset DECIMAL(15,2) NOT NULL,
    end_asset DECIMAL(15,2) NOT NULL,
    return_amount DECIMAL(15,2) NOT NULL,
    return_rate DECIMAL(8,4) NOT NULL,
    cumulative_return_rate DECIMAL(8,4) NOT NULL,
    max_drawdown DECIMAL(8,4),
    trade_count INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(account_id, date, time_frame)
);
```

#### 基准数据表
```sql
CREATE TABLE benchmark_performance (
    id SERIAL PRIMARY KEY,
    benchmark_code VARCHAR(10) NOT NULL, -- sh, hs300, sz, cyb
    date DATE NOT NULL,
    time_frame VARCHAR(10) NOT NULL,
    return_rate DECIMAL(8,4) NOT NULL,
    cumulative_return_rate DECIMAL(8,4) NOT NULL,
    max_drawdown DECIMAL(8,4),
    volatility DECIMAL(8,4),
    created_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(benchmark_code, date, time_frame)
);
```

### API接口设计

#### 获取账户表现数据
```python
@app.route('/api/account/performance')
def get_account_performance():
    """获取账户表现数据"""
    account_id = request.args.get('account_id')
    time_frame = request.args.get('time_frame', 'week')  # day/week/month/year
    limit = request.args.get('limit', 20)
    
    return {
        'summary': {
            'total_asset': 105234.00,
            'total_return': 5234.00,
            'total_return_rate': 5.23,
            'max_return': 8.45,
            'max_drawdown': -2.15,
            'win_rate': 65.2,
            'sharpe_ratio': 1.85,
            'volatility': 12.5,
            'trade_count': 156
        },
        'performance_data': [
            {
                'period': '2024年第3周',
                'start_asset': 102150.00,
                'end_asset': 105234.00,
                'return_amount': 3084.00,
                'return_rate': 3.02,
                'cumulative_return_rate': 5.23,
                'max_drawdown': -0.85,
                'trade_count': 23
            }
            # ... 更多数据
        ]
    }
```

#### 获取基准对比数据
```python
@app.route('/api/benchmark/comparison')
def get_benchmark_comparison():
    """获取基准对比数据"""
    account_id = request.args.get('account_id')
    benchmark = request.args.get('benchmark', 'sh')
    time_frame = request.args.get('time_frame', 'week')
    
    return {
        'account_metrics': {
            'cumulative_return': 5.23,
            'max_drawdown': -2.15,
            'sharpe_ratio': 1.85,
            'volatility': 12.5
        },
        'benchmark_metrics': {
            'cumulative_return': 2.15,
            'max_drawdown': -5.80,
            'sharpe_ratio': 0.92,
            'volatility': 18.3
        },
        'comparison': {
            'excess_return': 3.08,
            'drawdown_control': 3.65,
            'sharpe_advantage': 0.93,
            'volatility_reduction': -5.8
        }
    }
```

### 前端组件设计

#### 时间选择器组件
```javascript
const TimeFrameSelector = ({ currentFrame, onFrameChange }) => {
    const frames = [
        { key: 'day', label: '日' },
        { key: 'week', label: '周' },
        { key: 'month', label: '月' },
        { key: 'year', label: '年' }
    ];
    
    return (
        <div className="time-selector">
            {frames.map(frame => (
                <button
                    key={frame.key}
                    className={`time-btn ${currentFrame === frame.key ? 'active' : ''}`}
                    onClick={() => onFrameChange(frame.key)}
                >
                    {frame.label}
                </button>
            ))}
        </div>
    );
};
```

#### 性能指标卡片组件
```javascript
const PerformanceMetrics = ({ metrics }) => {
    const metricItems = [
        { icon: '📈', label: '最大收益', value: `+${metrics.maxReturn}%`, date: '2024-01-15' },
        { icon: '📉', label: '最大回撤', value: `${metrics.maxDrawdown}%`, date: '2024-01-12' },
        { icon: '🎯', label: '胜率', value: `${metrics.winRate}%`, date: '23胜/12负' },
        { icon: '⚡', label: '夏普比率', value: metrics.sharpeRatio, date: '风险调整收益' },
        { icon: '📊', label: '波动率', value: `${metrics.volatility}%`, date: '年化波动率' },
        { icon: '🔄', label: '交易次数', value: metrics.tradeCount, date: '本周期内' }
    ];
    
    return (
        <div className="stats-grid">
            {metricItems.map((item, index) => (
                <div key={index} className="stat-item">
                    <div className="stat-icon">{item.icon}</div>
                    <div className="stat-content">
                        <div className="stat-label">{item.label}</div>
                        <div className="stat-value">{item.value}</div>
                        <div className="stat-date">{item.date}</div>
                    </div>
                </div>
            ))}
        </div>
    );
};
```

## 📊 数据处理逻辑

### 收益率计算
```python
def calculate_returns(start_asset, end_asset):
    """计算收益率"""
    return_amount = end_asset - start_asset
    return_rate = (return_amount / start_asset) * 100
    return return_amount, return_rate

def calculate_cumulative_return(initial_asset, current_asset):
    """计算累计收益率"""
    return ((current_asset - initial_asset) / initial_asset) * 100

def calculate_max_drawdown(asset_series):
    """计算最大回撤"""
    peak = asset_series[0]
    max_dd = 0
    
    for asset in asset_series:
        if asset > peak:
            peak = asset
        drawdown = (peak - asset) / peak
        if drawdown > max_dd:
            max_dd = drawdown
    
    return max_dd * 100
```

### 时间周期聚合
```python
def aggregate_by_timeframe(daily_data, timeframe):
    """按时间周期聚合数据"""
    if timeframe == 'week':
        return daily_data.groupby(pd.Grouper(freq='W')).agg({
            'start_asset': 'first',
            'end_asset': 'last',
            'trade_count': 'sum'
        })
    elif timeframe == 'month':
        return daily_data.groupby(pd.Grouper(freq='M')).agg({
            'start_asset': 'first',
            'end_asset': 'last',
            'trade_count': 'sum'
        })
    # ... 其他时间周期处理
```

## 💡 用户价值

### 投资分析价值
- **全面的业绩回顾** - 多维度了解投资表现
- **风险收益评估** - 客观评价策略风险收益特征
- **基准对比分析** - 与市场基准进行专业对比
- **时间趋势分析** - 识别投资表现的时间规律

### 决策支持价值
- **策略优化指导** - 基于历史表现优化策略
- **风险控制改进** - 识别风险控制的薄弱环节
- **投资时机选择** - 基于历史规律选择最佳时机
- **资金配置优化** - 优化资金在不同策略间的配置

---

这个账户表现功能为用户提供了专业级的投资业绩分析工具，帮助用户全面了解和优化投资表现。
