# 模拟实盘交易功能开发计划

## 📋 项目概述

**功能名称**: 模拟实盘交易系统  
**优先级**: 最高  
**预计开发时间**: 6.5小时  
**目标**: 实现完整的模拟实盘交易功能，包括账户管理、实时数据、策略控制等

## 🎯 功能需求分析

基于`01-需求说明/Web界面交互式原型.html`的设计，模拟实盘交易功能包含：

### 核心组件
1. **账户资产概览** - 总资产¥105,234、今日盈亏+¥5,234、持仓数量8只、胜率65.2%
2. **大盘分析面板** - 上证指数、沪深300、深证成指、创业板指实时数据
3. **策略运行控制** - 动量策略v2.1运行状态、启停控制、运行时间显示
4. **持仓列表** - 当前持仓股票、盈亏情况、卖出操作
5. **实时数据更新** - WebSocket推送，每秒更新数据

## 🔧 技术架构

### 后端技术栈
- **框架**: FastAPI + SQLAlchemy
- **数据库**: SQLite (开发) / PostgreSQL (生产)
- **实时通信**: WebSocket
- **缓存**: Redis (可选)

### 前端技术栈
- **框架**: React 18 + Vite
- **UI库**: Ant Design
- **图表**: ECharts
- **状态管理**: React Hooks + Context
- **HTTP客户端**: Axios

## 📅 详细开发步骤

### 第一步：后端基础架构完善 (30分钟)
**状态**: 🔄 进行中

#### 任务清单
- [ ] 修复Python导入错误
- [ ] 确保数据库模型正常工作
- [ ] 测试FastAPI应用启动
- [ ] 初始化测试数据

#### 验收标准
- 后端服务能在http://localhost:8000启动
- Swagger文档可访问 http://localhost:8000/docs
- 数据库初始化成功，包含默认账户和测试数据

### 第二步：模拟交易核心API开发 (1小时)
**状态**: ⏳ 待开始

#### API端点设计
```
GET    /api/v1/accounts/1/summary           # 账户概览
GET    /api/v1/accounts/1/positions         # 持仓列表
POST   /api/v1/accounts/1/positions/sell    # 卖出股票
GET    /api/v1/market/realtime/indices      # 实时指数
GET    /api/v1/market/stats                 # 市场统计
POST   /api/v1/strategies/1/start           # 启动策略
POST   /api/v1/strategies/1/pause           # 暂停策略
POST   /api/v1/strategies/1/stop            # 停止策略
```

#### 验收标准
- 所有API返回正确JSON格式数据
- 通过Postman/curl测试验证
- 错误处理和状态码正确

### 第三步：前端React项目搭建 (45分钟)
**状态**: ⏳ 待开始

#### 项目初始化
```bash
cd web/frontend
npm create vite@latest . -- --template react
npm install antd axios echarts
```

#### 项目结构
```
web/frontend/
├── src/
│   ├── components/          # 通用组件
│   ├── pages/              # 页面组件
│   │   └── TradingPage/    # 模拟实盘交易页面
│   ├── services/           # API服务
│   ├── utils/              # 工具函数
│   └── App.jsx             # 主应用
├── public/
└── package.json
```

#### 验收标准
- 前端项目能在http://localhost:3000启动
- 基础路由和布局正常显示
- 能正常调用后端API

### 第四步：模拟实盘交易页面开发 (2小时)
**状态**: ⏳ 待开始

#### 4.1 账户资产概览组件 (30分钟)
```jsx
// src/components/AccountSummary.jsx
const AccountSummary = () => {
  return (
    <div className="metrics-grid">
      <MetricCard title="总资产" value="¥105,234" change="+5.23%" />
      <MetricCard title="今日盈亏" value="+¥5,234" change="+5.23%" />
      <MetricCard title="持仓数量" value="8" extra="仓位: 85%" />
      <MetricCard title="胜率" value="65.2%" extra="23胜/12负" />
    </div>
  );
};
```

#### 4.2 大盘分析组件 (45分钟)
```jsx
// src/components/MarketAnalysis.jsx
const MarketAnalysis = () => {
  return (
    <div className="market-analysis-panel">
      <IndexCards indices={marketIndices} />
      <MarketStats stats={marketStats} />
      <PerformanceComparison />
    </div>
  );
};
```

#### 4.3 策略控制组件 (15分钟)
```jsx
// src/components/StrategyControl.jsx
const StrategyControl = ({ strategy, onStart, onPause, onStop }) => {
  return (
    <div className="strategy-control">
      <StrategyStatus strategy={strategy} />
      <ControlButtons onStart={onStart} onPause={onPause} onStop={onStop} />
    </div>
  );
};
```

#### 4.4 持仓列表组件 (30分钟)
```jsx
// src/components/PositionList.jsx
const PositionList = ({ positions, onSell }) => {
  return (
    <Table 
      dataSource={positions}
      columns={positionColumns}
      rowKey="symbol"
    />
  );
};
```

#### 验收标准
- 所有组件正常渲染
- 样式与原型设计一致
- 组件间数据传递正常

### 第五步：前后端数据集成 (1小时)
**状态**: ⏳ 待开始

#### API服务封装
```javascript
// src/services/api.js
class TradingAPI {
  async getAccountSummary(accountId) { }
  async getPositions(accountId) { }
  async sellPosition(accountId, symbol, quantity) { }
  async getMarketData() { }
  async controlStrategy(strategyId, action) { }
}
```

#### 状态管理
```javascript
// src/hooks/useTradingData.js
const useTradingData = () => {
  const [account, setAccount] = useState(null);
  const [positions, setPositions] = useState([]);
  const [marketData, setMarketData] = useState(null);
  
  // API调用和状态更新逻辑
};
```

#### 验收标准
- 前端能成功调用所有后端API
- 数据显示正确
- 用户操作有正确反馈

### 第六步：WebSocket实时数据更新 (45分钟)
**状态**: ⏳ 待开始

#### WebSocket连接管理
```javascript
// src/services/websocket.js
class WebSocketService {
  connect(clientId) { }
  subscribe(topic, callback) { }
  disconnect() { }
}
```

#### 实时数据推送
- 账户资产数据每秒更新
- 市场指数数据实时推送
- 持仓盈亏实时计算

#### 验收标准
- WebSocket连接稳定
- 数据更新及时准确
- 断线重连机制正常

### 第七步：测试和优化 (30分钟)
**状态**: ⏳ 待开始

#### 功能测试
- [ ] 账户数据显示正确
- [ ] 策略启停功能正常
- [ ] 卖出股票功能正常
- [ ] 实时数据更新正常

#### 性能优化
- [ ] 页面加载速度 < 2秒
- [ ] WebSocket连接稳定
- [ ] 内存使用合理

#### 验收标准
- 所有功能测试通过
- 性能指标达标
- 用户体验良好

## 📊 进度跟踪

| 步骤 | 预计时间 | 实际时间 | 状态 | 完成度 |
|------|----------|----------|------|--------|
| 后端基础架构 | 30分钟 | - | 🔄 进行中 | 80% |
| 核心API开发 | 1小时 | - | ⏳ 待开始 | 0% |
| 前端项目搭建 | 45分钟 | - | ⏳ 待开始 | 0% |
| 交易页面开发 | 2小时 | - | ⏳ 待开始 | 0% |
| 前后端集成 | 1小时 | - | ⏳ 待开始 | 0% |
| 实时数据更新 | 45分钟 | - | ⏳ 待开始 | 0% |
| 测试和优化 | 30分钟 | - | ⏳ 待开始 | 0% |

**总进度**: 11.4% (80% × 1/7)

## 🎯 当前任务

**正在进行**: 第一步 - 后端基础架构完善  
**下一步**: 修复导入错误，测试API启动  
**预计完成时间**: 15分钟内

## 📝 开发日志

### 2024-01-16
- ✅ 创建详细开发计划
- 🔄 开始后端基础架构完善
- ⏳ 准备修复导入错误和测试API启动

---

*此文档将随开发进度实时更新*
